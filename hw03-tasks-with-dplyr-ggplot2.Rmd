---
title: "STAT545 Assignment 2"
author: "Alex"
date: "October 1, 2018"
output: github_document
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Initializing Gapminder Dataset and Libraries
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(gapminder)

# these two packages help make very pretty tables
library(knitr)
library(kableExtra)
```

## Tasks Attempted
| Task | Attempted |
|---------|-------|
| Max and Min GDP per Capita for all continents | :heavy_check_mark: |
| Distribution of GDP per capita within continents | :heavy_check_mark: |
| Mean Life Expectancy for different years weighted | :heavy_check_mark: |
| Life Expectancy Trajectory over time on different continents | :heavy_check_mark: |
| Relative Life Expectancy Exploration | :heavy_check_mark: |
| Open-ended exploration of **interesting** country histories | :heavy_check_mark: |

## Max and Min GDP per Continent
```{r}
gapminder %>%
  group_by(continent,country) %>%
  summarize(mu = mean(gdpPercap)) %>%
  summarize(max = round(max(mu),2),
            min = round(min(mu),2)) %>%
  kable(col.names = c("Continent", "Max. GDP per Capita", "Min. GDP per Capita"), "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", full_width = F))
```

We group by continent and country, and then summarize first by mean, then summarize by max and min of our previously calculated means. Piping this in kable presents us with the above table. We see that Europe contains the country with the highest GDP per capita as well as the country with the highest *minimum* GDP per capita, while Africa contains both the **lowest** max. and min. GDP per capita. This suggests that the standard of living on average is highest in Europe and lowest in Africa.

The country with the lowest range in GDP per capita is Oceania, but this may be in part due to the fact that there are not as many countries in Oceania as there are in the other 4 continents.


### Distribution of GDP per capita within continents
Although the previous section gave us some interesting information on the range of GDP per capita within continents, we do not have any informatino about the distribution of GDP per capita within each continent. To visualize the spread of GDP per Capita, a first guess would be to use histograms and facet by Continent. However, as we see from above it is not as illuminating as we would like; most of the graph is filled with blank space due to the skewness of the distributions (and due to facetting with the same x,y axes scales).

```{r, message=FALSE, warning=FALSE}
gapminder %>%
  ggplot(aes(gdpPercap)) +
  geom_histogram(aes(fill = continent)) +
  facet_wrap( ~ continent) +
  guides(fill=FALSE) +
  labs(x="GDP per Capita", y="Count")
```

Another idea would be to try a density plot and overlay the distributions on top of each other:

```{r}
gapminder %>%
  ggplot(aes(gdpPercap)) +
  geom_density(aes(fill = continent), alpha=0.5) +
  labs(x="GDP per Capita", y="Count")
```

This makes it easier to visually compare continents with each other, but we can probably do better by adding a log scale to the x-axis.

```{r}
gapminder %>%
  ggplot(aes(gdpPercap)) +
  geom_density(aes(fill = continent), alpha=0.5) +
  labs(x="GDP per Capita", y="Count") +
  scale_x_log10()
```

Much better! (Although keep in mind log scales make it harder to make good quantitative judgements.) From this graph we can quickly see that Asia contains the greatest variance in GDP per capita, followed by Africa. Between Africa and Asia, Africa has a considerably higher peak towards the low end of the GDP per capita distribution, reflecting what we found earlier that Africa contains both the lowest max. and min. GDP per capita across all continents.



## Trimmed Mean Life Expectancy in the Americas
A trimmed mean removes a portion of the largest and smallest elements in a set before computing the mean. This can be useful in situations where our data is skewed or non-normal in some way, allowing us to increase robustness while sacrificing efficiency for less heavily-tailed distributions such as the normal distribution [(ref: https://en.wikipedia.org/wiki/Truncated_mean)](https://en.wikipedia.org/wiki/Truncated_mean)
In R, we can achieve this by specifying the `trim` option in `mean()`.

Let's look at the trimmed mean life expectancy in the Americas for different years. We will trim by 25% on both ends (this is known as the interquartile mean (IQM)):

```{r}
table <- gapminder %>% # I save the output to "table" so that I can omit columns later when piping into kable for presentation. There may be a better way to do this
  filter(continent == "Americas") %>%
  group_by(continent, year) %>%
  summarize(intqrt_mean = round(mean(lifeExp, trim=0.25),2))
table[2:3] %>%
  kable(col.names = c("Year", "Interquartile Mean Life Expectancy"), "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", full_width = F))
```

Here we see that at the earliest timepoint in this dataset, the Americas had an IQM of 53.17, and steadly increased at each 5 year timepoint until reaching 73.75 in 2007, increasing by a total of 20.58 years over a period of 55 years. We can visualize this using a line plot:

```{r}
table %>%
  ggplot(aes(year,intqrt_mean)) +
  geom_point(colour = "Blue") + 
  geom_line(colour = "Red") +
  labs(title="Life Expectancy in the Americas over a 55 year period", x="Year", y="Interquartile Mean Life Expectancy (Years)")
```

This leads quite well to the next task, where we will look at change in life expectancy over time in all continents!

## Life Expectancy Change Over Time in Each Continent



